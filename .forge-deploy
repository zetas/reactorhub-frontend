#!/usr/bin/env bash
set -e

echo "üöÄ Deploying Frontend..."

cd $FORGE_SITE_PATH

# Pull latest code
git pull origin main

# Install dependencies
npm ci --prefer-offline --no-audit

# Create .env if it doesn't exist (Forge will populate on first deploy)
if [ ! -f .env ]; then
    echo "NEXT_PUBLIC_API_URL=https://api.ree.actor/api/v1" > .env
fi

# Create dummy auth.json if it doesn't exist (not needed for Next.js)
if [ ! -f auth.json ]; then
    echo "{}" > auth.json
fi

# Export environment variables for build
export $(cat .env | grep -v '^#' | xargs)

# Build Next.js
NODE_ENV=production npm run build

# Restart Next.js daemon
sudo supervisorctl restart reactorhub-frontend || echo "‚ö†Ô∏è  Daemon not configured yet"

echo "‚úÖ Frontend deployment complete!"
